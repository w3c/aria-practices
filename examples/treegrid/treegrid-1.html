<tree!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />

<title>Treegrid Email Inbox Example | WAI-ARIA Authoring Practices 1.1</title>

<!--  Core js and css shared by all examples; do not modify when using this template. -->
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css">
<link rel="stylesheet" href="../css/core.css">
<script src="../js/examples.js"></script>
<script src="../js/highlight.pack.js"></script>
<script src="../js/app.js"></script>

<!--  js and css for this example. -->
<link href="css/treegrid-1.css" rel="stylesheet">
<style>
  /* Style the current cell focus option so user know what they're getting */
  [aria-current] {
    position: relative;
    outline: 2px solid green;
    outline-offset: 3px;
    background-color: #fffff8;
  }
  [aria-current] > a::before {
    display: inline-block;
    position: absolute;
    content: "Current";
    font-size: 80%;
    right: -3px;
    top: -3px;
    padding: 3px 1ch;
    background-color: green;
    color: white;
    font-weight: bold;
  }
</style>
<script src="js/treegrid-1.js" type="text/javascript"></script>
<script>
/* Init Script for TreeGrid */
/* Get an object where each field represents a URL parameter */
/* global TreeGrid */
function getQuery () {
  if (!getQuery.cached) {
    getQuery.cached = {};
    const queryStr = window.location.search.substring(1);
    const vars = queryStr.split('&');
    for (let i = 0; i<vars.length; i++) {
      const pair = vars[i].split('=');
      // If first entry with this name
      getQuery.cached[pair[0]] = pair[1] && decodeURIComponent(pair[1]);
    }
  }
  return getQuery.cached;
}

document.addEventListener('DOMContentLoaded', function () {
  // Supports url parameter ?cell=force or ?cell=start (or leave out parameter)
  var cellParam = getQuery().cell;
  var doAllowRowFocus = cellParam !== 'force';
  var doStartRowFocus = doAllowRowFocus && cellParam !== 'start';
  TreeGrid(document.getElementById('treegrid'), doAllowRowFocus, doStartRowFocus);
  var choiceElem = document.getElementById('option-cell-focus-' + (cellParam || 'allow'));
  choiceElem.setAttribute('aria-current', 'true');
});
</script>
</head>
<body>
  <nav aria-label="Related Links" class="feedback">
    <ul>
      <li><a href="../../#browser_and_AT_support">Browser and Assistive Technology Support</a></li>
      <li><a href="https://github.com/w3c/aria-practices/issues/new">Report Issue</a></li>
      <li><a href="https://github.com/w3c/aria-practices/projects/17">Related Issues</a></li>
      <li><a href="../../#treegrid">Treegrid Design Pattern</a></li>
    </ul>
</nav>
  <main>
  <h1>Treegrid Email Inbox Example</h1>

  <p>
    <strong>NOTE:</strong> This example page is not yet complete.
    Development of this example is tracked by
    <a href="https://github.com/w3c/aria-practices/issues/132">issue 132.</a>
  </p>
  <p>
    The following example demonstrates how the
    <a href="../../#treegrid">treegrid design pattern (TBD)</a>
    can be used to make an interactive tree that enables users to navigate the hierarchical structure of email conversations
    and also provides the ability to navigate to elements that describe each email, such as subject and sender.
  </p>
  <p>
    This same example can be used in three ways.
  </p>
  <ul>
    <li id="option-cell-focus-allow"><a href="./treegrid-1.html">Rows are focused first, but cells can be focused</a>:<br>Useful when we want to present the treegrid to act primarily like a tree.</li>
    <li id="option-cell-focus-start"><a href="./treegrid-1.html?cell=start">Cells are focused first, but rows can also be focused</a>:<br>Useful when we want to present the treegrid to act primarily like a grid.</li>
    <li id="option-cell-focus-force"><a href="./treegrid-1.html?cell=force">Only cells can be focused</a>:<br>Useful when we we are primarily a grid, and we want to simplify the user experience by removing row navigation options.</li>
  </ul>
  <p>
    Note: no row-only version is provided. A row-only navigation version could be useful when the columns are guaranteed to fit horizontally (no horizontal scrolling necessary), the columns are merely for attractive presentation, as opposed to addressing any need to visit them individually. However, in this case the author can simply follow the tree pattern and present the child treeitem data in columns.
  </p>

  <section>
    <h2 id="ex_label">Example</h2>
    <div role="separator" id="ex_start_sep" aria-labelledby="ex_start_sep ex_label" aria-label="Start of"></div>
    <!--
      Note the ID of the following div that contains the example HTML is used as a parameter for the sourceCode.add() function.
      The sourceCode functions in the examples/js/examples.js render the HTML source to show it to the reader of the example page.
      If you change the ID of this div, be sure to update the parameters of the sourceCode.add() function call, which is made following the div with id="sc1" where the HTML is render.
      The div for the rendered HTML source is in the last section of the page.
    -->
    <div id="ex1">
      <table id="treegrid" role="treegrid" aria-label="ARIA treegrid e-mail inbox example">
        <colgroup>
          <col id="treegrid-col1">
          <col id="treegrid-col2">
          <col id="treegrid-col3">
        </colgroup>
        <thead>
          <tr>
            <th role="columnheader">Subject</th>
            <th role="columnheader">Summary</th>
            <th role="columnheader">Email</th>
          </tr>
        </thead>
        <tbody>
          <tr role="row" aria-level="1" aria-posinset="1" aria-setsize="1" aria-expanded="true">
            <td role="gridcell">Treegrids are awesome</td>
            <td role="gridcell">Want to learn how to use them?</td>
            <td role="gridcell"><a href="mailto:aaron@thegoogle.rocks">aaron@thegoogle.rocks</a></td>
          </tr>
          <tr role="row" aria-level="2" aria-posinset="1" aria-setsize="3">
             <td role="gridcell">re: Treegrids are awesome</td>
             <td role="gridcell">I agree with you, they are the shizzle</td>
             <td role="gridcell"><a href="mailto:joe@blahblahblah.blahblah">joe@blahblahblah.blahblah</a></td>
          </tr>
          <tr role="row" aria-level="2" aria-posinset="2" aria-setsize="3" aria-expanded="false">
             <td role="gridcell">re: Treegrids are awesome
             <td role="gridcell">They are great for showing a lot of data, like a grid
             <td role="gridcell"><a href="mailto:billy@dangerous.fish">billy@dangerous.fish</a></td>
          </tr>
          <tr role="row" aria-level="3" aria-posinset="1" aria-setsize="1" class="hidden">
             <td role="gridcell">re: Treegrids are awesome</td>
             <td role="gridcell">Cool, we've been needing an example and documentation</td>
             <td role="gridcell"><a href="mailto:doris@rufflazydogs.sleep">doris@rufflazydogs.sleep</a></td>
          </tr>
          <tr role="row" aria-level="2" aria-posinset="3" aria-setsize="3" aria-expanded="false">
             <td role="gridcell">re: Treegrids are awesome</td>
             <td role="gridcell">I hear the Fancytree library is going to align with this example!</td>
             <td role="gridcell"><a href="mailto:someone@please-do-it.company">someone@please-do-it.company</a></td>
          </tr>
          <tr role="row" aria-level="3" aria-posinset="1" aria-setsize="1" aria-expanded="false" class="hidden">
             <td role="gridcell">re: Treegrids are awesome</td>
             <td role="gridcell">Sometimes they are more like trees, otherse are more like grids</td>
             <td role="gridcell"><a href="mailto:mari@beingpractical.com">mari@beingpractical.com</a></td>
          </tr>
          <tr role="row" aria-level="4" aria-posinset="1" aria-setsize="2" class="hidden">
             <td role="gridcell">re: Treegrids are awesome</td>
             <td role="gridcell">Cool, when it's a tree, let's keep left/right to collapse/expand</td>
             <td role="gridcell"><a href="mailto:issie@imadeadcatsadly.wascute">issie@imadeadcatsadly.wascute</a></td>
          </tr>
          <tr role="row" aria-level="4" aria-posinset="2" aria-setsize="2" class="hidden">
             <td role="gridcell">re: Treegrids are awesome
             <td role="gridcell">I see, sometimes right arrow moves by column</td>
             <td role="gridcell"><a href="mailto:kitten@kittenseason.future">kitten@kittenseason.future</a></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div role="separator" id="ex_end_sep" aria-labelledby="ex_end_sep ex_label" aria-label="End of"></div>

  </section>

  <section>
    <h2>Accessibility Features</h2>

    <p>Focusable Elements in Current Row</p>
    <ul>
      <li>
        This example uses the roving tabindex technique to manage the tabbing into and out of the treegrid and tabindex values are managed through javascript.
      </li>
      <li>
        If a <code>gridcell</code> contains a focusable element (e.g. <code>a</code>, <code>input</code>), the focusable element gets focus instead of the <code>gridcell</code>.  In this example the e-mail address column contains links, so the link receives focus when the user navigates to the <code>gridcell</code>.
      </li>
      <li>
        The e-mail address link in the current message row with focus is included in the tabbing order (e.g. <code>tabIndex=<q>0</q></code>) of the page, all other links in the <code>treegrid</code> are not in the tabbing order of the page (e.g. <code>tabIndex=<q>-1</q></code>).
      </li>
    </ul>

  </section>

  <section>
    <h2 id="kbd_label">Keyboard Support</h2>

     <table aria-labelledby="kbd_label" class="def">
      <thead>
        <tr>
          <th>Key</th>
          <th>Function</th>
        </tr>
      </thead>
      <tbody>
      <tr>
        <th scope="row">
          <kbd>Right Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, and it is collapsed, expands the current row.</li>
            <li>If a row is focused, and it is expanded, focuses the first cell in the row.</li>
            <li>If a cell is focused, moves one cell to the right.</li>
            <li>If focus is on the right most cell, focus does not move.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Left Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, and it is expanded, collapses the current row.</li>
            <li>If a row is focused, and it is collapsed, moves to the parent row (if there is one).</li>
            <li>If a cell in the first column is focused, focuses the row.</li>
            <li>If a cell in a different column is focused, moves focus one cell to the left.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Down Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus one row or one cell down, depending on whether a row or cell is currently focused.</li>
            <li>If focus is on the bottom row, focus does not move.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Up Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus one row or one cell up, depending on whether a row or cell is currently focused.</li>
            <li>If focus is on the top row, focus does not move.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Tab</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus to the next interactive cell in the current row.</li>
            <li>If there are no more interactive cells in the current row,
              moves out of the treegrid.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Shift + Tab</kbd>
        </th>
        <td>
          <ul>
            <li>If a cell is focused, moves focus to the previous interactive cell in the current row.</li>
            <li>If a row is focused, moves out of the treegrid.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Home</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, moves to the first row.</li>
            <li>If a cell is focused, moves focus to the row's first cell.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>End</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, moves to the last row.</li>
            <li>If a cell is focused, moves focus to the row's last cell.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Control + Home</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus to the first row.</li>
            <li>If a cell was focused, focus is kept in the same column,
              otherwise the entire first row is focused.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Control + End</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus to the last row.</li>
            <li>If a cell was focused, focus is kept in the same column,
              otherwise the entire last row is focused.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Enter</kbd>
        </th>
        <td>
          <ul>
            <li>Performs default action on row or cell, e.g. opens message or navigate to link.</li>
            <li>If focus is on the cell with the expand/collapse button, and there is no other action,
              will toggle expansion of the current row.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Space</kbd>
        </th>
        <td>
          <ul>
            <li>In the case of multiselect treegrid, can be used to check a selection checkbox</li>
          </ul>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2 id="rps_label">Role, Property, State, and Tabindex  Attributes</h2>
    <!--
      Update this table to describe how roles, properties, states, and tabindex are used in this example.
    -->
    <table aria-labelledby="rps_label" class="data attributes">
      <thead>
        <tr>
          <th scope="col">Role</th>
          <th scope="col">Attribute</th>
          <th scope="col">Element</th>
          <th scope="col">Usage</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row"><code>treegrid</code></th>
          <td><!--  Leave this cell blank in rows where a role is being described. --></td>
          <td><code>table</code></td>
          <td>
            Identifies the element as a <code>treegrid</code>.
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <th scope="row"><code>aria-label=<q>ARIA Treegrid Example</q></code></th>
          <td><code>table</code></td>
          <td>
            <ul>
              <li>Provides an accessible name for the <code>treegrid</code>.</li>
              <li><code>treegrid</code> requires an accessible name.</li>
            </ul>
          </td>
        </tr>
        <tr>
          <th scope="row"><code>columnheader</code></th>
          <td><!--  Leave this cell blank in rows where a role is being described. --></td>
          <td><code>th</code></td>
          <td>
            <ul>
              <li>Identifies the element as a <code>columnheader</code>.</li>
              <li>Column headers provide context (e.g. label) for the values of the <code>gridcell</code>s in the <code>treegrid</code>.</li>
            </ul>
          </td>
        </tr>
        <tr>
          <th scope="row"><code>row</code></th>
          <td><!--  Leave this cell blank in rows where a role is being described. --></td>
          <td><code>tr</code></td>
          <td>
            <ul>
              <li>Identifies the element as a <code>row</code> in the <code>treegrid</code>.</li>
              <li>The accessible name for the <code>row</code> comes from concatenating the text content of the child <code>gridcell</code>s.</li>
          </td>
        </tr>
        <tr>
          <td></td>
          <th scope="row"><code>tabindex=<q>-1</q></code></th>
          <td><code>tr</code></td>
          <td>
            <ul>
              <li>Makes the <code>row</code> element focusable without including it in the tab sequence of the page.</li>
              <li>All <code>row</code> and <code>gridcell</code> elements are focusable, but only one is included in the tab sequence.</li>
             </ul>
          </td>
        </tr>
        <tr>
          <td></td>
          <th scope="row"><code>tabindex=<q>0</q></code></th>
          <td><code>tr</code></td>
          <td>
            <ul>
              <li>Includes the <code>row</code> element in the tab sequence.</li>
              <li>Only one <code>row</code> or <code>gridcell</code> in the <code>treegrid</code> has <code>tabindex=&quot;0&quot;</code>.</li>
              <li>In this implementation, the first <code>row</code> in the <code>treegrid</code> is included in the tab sequence when the page loads.</li>
              <li>
                When the user moves focus in the <code>treegrid</code>, the element included in the tab sequence changes to the element with focus as described in the section on
                <a href="../../../#kbd_roving_tabindex">roving tabindex.</a>
              </li>
             </ul>
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <th scope="row"><code>aria-expanded=<q>false</q></code></th>
          <td><code>tr</code> or <code>td</code></td>
          <td>
            <ul>
              <li>Applied only to rows or cells elements that are parent rows. i.e., next set of rows are response to the message in this row</li>
              <li>Indicates the parent row is closed, i.e., the descendant rows are not visible.</li>
              <li>The visual indication of the collapsed state is synchronized by a CSS attribute selector.</li>
              <li>When the treegrid is configured to support focus on rows <code>aria-expanded</code> is on the <code>tr</code> elements, but when the treegrid is configured to support focus on cells only, <code>aria-expanded</code> is on the first <code>td</code> element contained in each row.</li>
            </ul>
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <th scope="row"><code>aria-expanded=<q>true</q></code></th>
          <td><code>tr</code> or <code>td</code></td>
          <td>
            <ul>
              <li>Applied only to rows or cells elements that are parent rows. i.e., next set of rows are response to the message in this row</li>
              <li>Indicates the parent row is open, i.e., the descendant rows are visible.</li>
              <li>The visual indication of the open state is synchronized by a CSS attribute selector.</li>
              <li>When the treegrid is configured to support focus on rows <code>aria-expanded</code> is on the <code>tr</code> elements, but when the treegrid is configured to support focus on cells only, <code>aria-expanded</code> is on the first <code>td</code> element contained in each row.</li>
            </td>
        </tr>
        <tr>
          <td>
          </td>
          <th scope="row"><code>aria-level=<q><em>number</em></q></code></th>
          <td><code>tr</code></td>
          <td>
            <ul>
              <li>Defines the level of the row in the hierarchical treegrid structure.</li>
              <li>Counting is one-based.</li>
              <li>Root rows have aria-level=“1”.</li>
            </ul>
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <th scope="row"><code>aria-setsize=<q><em>number</em></q></code></th>
          <td><code>tr</code></td>
          <td>
            Defines the number of rows in the set of rows that are in the same branch and at the same level within the hierarchy.
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <th scope="row"><code>aria-posinset=<q><em>number</em></q></code></th>
          <td><code>tr</code></td>
          <td>
            <ul>
              <li>Defines the position of the row within the set of other rows that are in the same branch and at the same level within the hierarchy.</li>
              <li>Counting is one-based, not zero-based.</li>
            </ul>
          </td>
        </tr>
        <tr>
          <th scope="row"><code>gridcell</code></th>
          <td><!--  Leave this cell blank in rows where a role is being described. --></td>
          <td><code>td</code></td>
          <td>
            Identifies the element as a <code>gridcell</code>.
          </td>
        </tr>
        <tr>
          <td></td>
          <th scope="row"><code>tabindex=<q>-1</q></code></th>
          <td><code>td</code></td>
          <td>
            <ul>
              <li>Makes the <code>gridcell</code> element focusable without including it in the tab sequence of the page.</li>
              <li>All <code>row</code> and <code>gridcell</code> elements are focusable, but only one is included in the tab sequence.</li>
             </ul>
          </td>
        </tr>
        <tr>
          <td></td>
          <th scope="row"><code>tabindex=<q>0</q></code></th>
          <td><code>td</code></td>
          <td>
            <ul>
              <li>Includes the <code>gridcell</code> element in the tab sequence.</li>
              <li>Only one <code>row</code> or <code>gridcell</code> in the <code>treegrid</code> has <code>tabindex=&quot;0&quot;</code>.</li>
              <li>In this implementation, the first <code>row</code> in the <code>treegrid</code> is included in the tab sequence when the page loads.</li>
              <li>
                When the user moves focus in the <code>treegrid</code>, the element included in the tab sequence changes to the element with focus as described in the section on
                <a href="../../../#kbd_roving_tabindex">roving tabindex.</a>
              </li>
             </ul>
          </td>
        </tr>      </tbody>
    </table>
  </section>

  <section>
    <h2>Javascript and CSS Source Code</h2>
    <!--  After the js and css files are named with the name of this example, change the href and text of the following 2 links to refer to the appropriate js and css files.  -->
    <ul>
      <li>
        CSS:
        <a href="css/treegrid-1.css" type="text/css">treegrid-1.css</a>
      </li>
      <li>
        Javascript:
        <a href="js/treegrid-1.js" type="text/javascript">treegrid-1.js</a>
      </li>
    </ul>
  </section>

  <section>
    <h2 id="sc1_label">HTML Source Code</h2>
    <div role="separator" id="sc1_start_sep" aria-labelledby="sc1_start_sep sc1_label" aria-label="Start of"></div>
    <pre><code id="sc1"></code></pre>
    <div role="separator" id="sc1_end_sep" aria-labelledby="sc1_end_sep sc1_label" aria-label="End of"></div>
    <!--
      The following script will show the reader the HTML source for the example that is in the div with ID 'ex1'.
      It renders the HTML in the preceding pre element with ID 'sc1'.
      If you change the ID of either the 'ex1' div or the 'sc1' pre, be sure to update the sourceCode.add function parameters.
      -->
    <script>
      sourceCode.add('sc1', 'ex1');
      sourceCode.make();
    </script>
  </section>
  </main>
  <nav>
    <!--  Update the pattern_ID parameter of this link to refer to the APG design pattern section related to this example.  -->
    <a href="../../#treegrid">Treegrid Design Pattern in WAI-ARIA Authoring Practices 1.1</a>
  </nav>
</body>
</html>
